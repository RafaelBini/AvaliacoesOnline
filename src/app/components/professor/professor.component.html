<app-barra-navegacao [caminho]="caminho"></app-barra-navegacao>

<mat-tab-group mat-align-tabs="center" mat-stretch-tabs [selectedIndex]="selectedTab"
    (selectedIndexChange)="tabAlterada($event)">
    <mat-tab>
        <ng-template mat-tab-label>
            <mat-icon style="margin-right: 8px;">description</mat-icon>
            Avaliações
        </ng-template>

        <div style="position: relative;">

            <div
                style="background-color: var(--cor-bloco); color: var(--cor-bloco-letra); padding: 15px; width: 60%; border-radius: 8px; margin: auto; margin-top: 20px;">
                <table style="width: 90%; margin: auto; display: block;">
                    <tr>
                        <td colspan="2" align="center">
                            <h2>Minhas Avaliações</h2>
                        </td>
                    </tr>
                    <tr>
                        <td width="95%">
                            <input type="text" class="input-clean" style="width: 100%;" #inputBusca maxlength="85"
                                (keyup)="onBuscaKeyUp(inputBusca.value)"
                                placeholder="Digite aqui uma parte do titulo, descrição ou tag da avaliação que procura" />
                        </td>
                        <td width="5%" style="padding: 5px;">
                            <button mat-icon-button>
                                <mat-icon style="color: gray;">search</mat-icon>
                            </button>
                        </td>
                    </tr>
                </table>
            </div>

            <!-- AVALIAÇÕES AGRUPADAS -->
            <mat-tab-group mat-align-tabs="center" *ngIf="agruparAvaliacoes" [selectedIndex]="selectedStatusTab"
                class="sem-bottom-border">

                <mat-tab *ngFor="let status of comumService.statusAvaliacao">
                    <ng-template mat-tab-label>
                        {{status.nome}} ({{getAvaliacoesNoStatus(status.id).length}})
                    </ng-template>

                    <table style="width: 100%;  margin-top: 20px;">
                        <tr *ngFor="let avaliacao of getAvaliacoesNoStatus(status.id)">
                            <td>
                                <app-avaliacao-card-professor [avaliacao]="avaliacao"></app-avaliacao-card-professor>
                            </td>
                        </tr>
                    </table>

                </mat-tab>
            </mat-tab-group>

            <!-- AVALIAÇÕES DESAGRUPADAS -->
            <table *ngIf="agruparAvaliacoes == false" style="width: 100%; margin-top: 20px;">
                <tr *ngFor="let avaliacao of getTodasAvaliacoes()">
                    <td>
                        <app-avaliacao-card-professor [avaliacao]="avaliacao"></app-avaliacao-card-professor>
                    </td>
                </tr>

            </table>

        </div>

        <button mat-fab [matMenuTriggerFor]="menu" matTooltip="Opções de Filtro"
            style="z-index: 1000; position: fixed; right: 50px; bottom: 120px; background-color: var(--cor-primaria); color: white">
            <mat-icon>more_vert</mat-icon>
        </button>
        <mat-menu #menu="matMenu" yPosition="above" xPosition="before">
            <button mat-menu-item (click)="agruparAvaliacoes = !agruparAvaliacoes">
                {{agruparAvaliacoes ? 'Desagrupar' : 'Agrupar'}}
            </button>
            <button mat-menu-item (click)="mostrarArquivadas = !mostrarArquivadas">
                {{mostrarArquivadas ? 'Esconder Arquivadas' : 'Mostrar Arquivadas'}}
            </button>
        </mat-menu>

        <a routerLink="/professor/avaliacao/nova" matTooltip="Nova Avaliação"
            style="z-index: 1000; position: fixed; right: 50px; bottom: 50px; background-color: var(--cor-primaria); color: white"
            mat-fab>
            <mat-icon>add</mat-icon>
        </a>

    </mat-tab>
    <mat-tab>
        <ng-template mat-tab-label>
            <mat-icon style="margin-right: 8px;">recent_actors</mat-icon>
            Alunos
        </ng-template>

        <div
            style="background-color: whitesmoke; padding: 15px; width: 60%; border-radius: 8px; margin: auto; margin-top: 20px;margin-bottom: 10px;">
            <table style="width: 90%; margin: auto; display: block;">
                <tr>
                    <td colspan="2" align="center">
                        <h2>Meus Alunos</h2>
                    </td>
                </tr>
                <tr>
                    <td width="95%">
                        <input type="text" class="input-clean" style="width: 100%;" #inputBuscaAluno maxlength="85"
                            (keyup)="onBuscaAlunoKeyUp(inputBuscaAluno.value)"
                            placeholder="Digite aqui uma parte do nome, email ou tag do aluno que procura" />
                    </td>
                    <td width="5%" style="padding: 5px;">
                        <button mat-icon-button>
                            <mat-icon style="color: gray;">search</mat-icon>
                        </button>
                    </td>
                </tr>
                <tr>
                    <td align="center" colspan="2">
                        <button mat-button (click)="selecionarTodos()">
                            {{alunosFiltrados.length == alunosSelecionados.length ? 'Deselecionar' : 'Selecionar'}}
                            Todos
                        </button>

                    </td>
                </tr>
            </table>
        </div>

        <mat-selection-list
            style="margin-top: 20px; margin-bottom: 40px; width: 60%; margin: auto; padding: 15px; background-color: whitesmoke;"
            [(ngModel)]="alunosSelecionados">

            <mat-list-option checkboxPosition="before" class="aluno" *ngFor="let aluno of alunosFiltrados"
                [value]="aluno.email">
                <table style="width: 100%;">
                    <tr class="aluno-line">
                        <td width="10">
                            <img src="assets/avatares/padrao.jpg" style="height: 5vh; width: 5vh; object-fit: cover;" />
                        </td>
                        <td width="25%">
                            {{aluno.nome}}
                        </td>
                        <td width="25%">
                            {{aluno.email}}
                        </td>
                        <td width="40%">
                            <div style="display: flex; flex-wrap: wrap;">
                                <div *ngFor="let tag of aluno.tags" class="tag">
                                    {{tag}}
                                </div>
                            </div>
                        </td>

                    </tr>
                </table>
            </mat-list-option>
            <span style="margin: auto; display: block; margin-top: 25px;"> Mostrando
                {{alunosFiltrados.length}} de {{alunos.length}}</span>
        </mat-selection-list>
        <div style="height: 40px">

        </div>


        <button (click)="addAluno()" matTooltip="Novo Aluno"
            style="position: fixed; right: 30px; bottom: 50px; background-color: var(--cor-primaria); color: white"
            mat-fab>
            <mat-icon>add</mat-icon>
        </button>
        <a matTooltip="Importar alunos via CSV"
            style="position: fixed; right: 30px; bottom: 120px; background-color: var(--cor-primaria); color: white"
            mat-fab>
            <mat-icon>arrow_upward</mat-icon>
        </a>
        <button *ngIf="alunosSelecionados.length > 0" (click)="removerAlunosSelecionados()"
            matTooltip="Remover alunos selecionados"
            style="position: fixed; left: 30px; bottom: 50px; background-color: var(--cor-perigosa); color: white"
            mat-fab>
            <mat-icon>delete</mat-icon>
        </button>
        <button *ngIf="alunosSelecionados.length > 1" matTooltip="Adicionar tags aos alunos selecionados"
            style="position: fixed; left: 30px; bottom: 120px; background-color: var(--cor-primaria); color: white"
            mat-fab>
            <mat-icon>style</mat-icon>
        </button>
        <button *ngIf="alunosSelecionados.length == 1" matTooltip="Editar o aluno selecionado"
            style="position: fixed; left: 30px; bottom: 120px; background-color: var(--cor-primaria); color: white"
            mat-fab>
            <mat-icon>create</mat-icon>
        </button>


    </mat-tab>
    <mat-tab>
        <ng-template mat-tab-label>
            <mat-icon style="margin-right: 8px;">account_circle</mat-icon>
            Meu Perfil
        </ng-template>

        <app-usuario-perfil-editar></app-usuario-perfil-editar>

    </mat-tab>
    <mat-tab>
        <ng-template mat-tab-label>
            <mat-icon style="margin-right: 8px;">dashboard</mat-icon>
            Dashboard
        </ng-template>

    </mat-tab>
</mat-tab-group>